<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 520" font-family="'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <!-- Hatched pattern for UberPage blocks -->
    <pattern id="hatch" patternUnits="userSpaceOnUse" width="6" height="6" patternTransform="rotate(45)">
      <rect width="6" height="6" fill="#fef3c7"/>
      <line x1="0" y1="0" x2="0" y2="6" stroke="#f59e0b" stroke-width="1.5"/>
    </pattern>
    <!-- Subtle grid pattern -->
    <pattern id="grid" patternUnits="userSpaceOnUse" width="20" height="20">
      <rect width="20" height="20" fill="none"/>
      <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e5e7eb" stroke-width="0.5" opacity="0.5"/>
    </pattern>
    <!-- Drop shadow -->
    <filter id="shadow" x="-2%" y="-2%" width="104%" height="104%">
      <feDropShadow dx="0" dy="1" stdDeviation="2" flood-color="#000" flood-opacity="0.1"/>
    </filter>
    <!-- Arrow marker -->
    <marker id="arrow" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280"/>
    </marker>
    <marker id="arrow-blue" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="960" height="520" fill="#fafafa" rx="8"/>
  <rect width="960" height="520" fill="url(#grid)" rx="8"/>

  <!-- Title -->
  <text x="40" y="38" font-size="18" font-weight="700" fill="#111827">Logical Device Layout of a Resource</text>
  <text x="40" y="56" font-size="12" fill="#6b7280">How SirixDB stores versioned data on disk using copy-on-write page fragments</text>

  <!-- Legend box -->
  <rect x="620" y="14" width="320" height="115" rx="6" fill="white" stroke="#d1d5db" stroke-width="1" filter="url(#shadow)"/>
  <text x="640" y="35" font-size="12" font-weight="600" fill="#374151">Legend</text>
  <line x1="640" y1="42" x2="920" y2="42" stroke="#e5e7eb" stroke-width="1"/>

  <!-- Legend items - left column -->
  <rect x="640" y="50" width="14" height="10" fill="url(#hatch)" stroke="#f59e0b" stroke-width="0.8" rx="1"/>
  <text x="660" y="59" font-size="10" fill="#4b5563">H  &#8212;  UberPage (header)</text>

  <rect x="640" y="68" width="14" height="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="0.8" rx="1"/>
  <text x="660" y="77" font-size="10" fill="#4b5563">PF  &#8212;  Page Fragment <tspan font-size="9" font-style="italic">p</tspan> of revision <tspan font-size="9" font-style="italic">r</tspan></text>

  <rect x="640" y="86" width="14" height="10" fill="#fed7aa" stroke="#f97316" stroke-width="0.8" rx="1"/>
  <text x="660" y="95" font-size="10" fill="#4b5563">RRP  &#8212;  RevisionRootPage</text>

  <rect x="640" y="104" width="14" height="10" fill="#f3e8ff" stroke="#a855f7" stroke-width="0.8" rx="1"/>
  <text x="660" y="113" font-size="10" fill="#4b5563">LD  &#8212;  Logical Device (file)</text>

  <!-- Legend items - right column -->
  <text x="820" y="59" font-size="10" fill="#4b5563">R<tspan font-size="8" baseline-shift="sub">n</tspan>  &#8212;  Revision <tspan font-size="9" font-style="italic">n</tspan></text>
  <text x="820" y="77" font-size="10" fill="#4b5563">TSP  &#8212;  Timestamp</text>
  <text x="820" y="95" font-size="10" fill="#4b5563">OFFS  &#8212;  Offset into LD</text>
  <text x="820" y="113" font-size="10" fill="#4b5563">Blk  &#8212;  Block size</text>

  <!-- ============================================ -->
  <!-- LD₂ — UberPage / Revision Index              -->
  <!-- ============================================ -->

  <!-- LD₂ label -->
  <rect x="20" y="150" width="36" height="80" rx="4" fill="#f3e8ff" stroke="#a855f7" stroke-width="1.2"/>
  <text x="38" y="195" font-size="13" font-weight="600" fill="#7e22ce" text-anchor="middle">LD<tspan font-size="9" baseline-shift="sub">2</tspan></text>

  <!-- LD₂ timeline -->
  <line x1="70" y1="190" x2="920" y2="190" stroke="#d1d5db" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- UberPage slot 1 (R₁) -->
  <rect x="90" y="160" width="90" height="60" rx="4" fill="url(#hatch)" stroke="#f59e0b" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="135" y="182" font-size="10" font-weight="600" fill="#92400e" text-anchor="middle">TSP</text>
  <line x1="135" y1="186" x2="135" y2="186" stroke="#d97706" stroke-width="0.5"/>
  <text x="135" y="198" font-size="10" font-weight="600" fill="#92400e" text-anchor="middle">OFFS</text>
  <text x="135" y="212" font-size="8" fill="#b45309" text-anchor="middle">rev 1</text>

  <!-- UberPage slot 2 (R₂) -->
  <rect x="200" y="160" width="90" height="60" rx="4" fill="url(#hatch)" stroke="#f59e0b" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="245" y="182" font-size="10" font-weight="600" fill="#92400e" text-anchor="middle">TSP</text>
  <text x="245" y="198" font-size="10" font-weight="600" fill="#92400e" text-anchor="middle">OFFS</text>
  <text x="245" y="212" font-size="8" fill="#b45309" text-anchor="middle">rev 2</text>

  <!-- UberPage slot 3 (R₃) -->
  <rect x="310" y="160" width="90" height="60" rx="4" fill="url(#hatch)" stroke="#f59e0b" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="355" y="182" font-size="10" font-weight="600" fill="#92400e" text-anchor="middle">TSP</text>
  <text x="355" y="198" font-size="10" font-weight="600" fill="#92400e" text-anchor="middle">OFFS</text>
  <text x="355" y="212" font-size="8" fill="#b45309" text-anchor="middle">rev 3</text>

  <!-- Ellipsis after UberPage slots -->
  <text x="430" y="195" font-size="18" fill="#9ca3af" text-anchor="middle">...</text>

  <!-- Block size bracket for LD₂ -->
  <line x1="90" y1="230" x2="90" y2="238" stroke="#9ca3af" stroke-width="0.8"/>
  <line x1="90" y1="238" x2="180" y2="238" stroke="#9ca3af" stroke-width="0.8"/>
  <line x1="180" y1="230" x2="180" y2="238" stroke="#9ca3af" stroke-width="0.8"/>
  <text x="135" y="250" font-size="9" fill="#9ca3af" text-anchor="middle">Blk</text>

  <!-- ============================================ -->
  <!-- LD₁ — Data Pages                              -->
  <!-- ============================================ -->

  <!-- LD₁ label -->
  <rect x="20" y="280" width="36" height="130" rx="4" fill="#f3e8ff" stroke="#a855f7" stroke-width="1.2"/>
  <text x="38" y="350" font-size="13" font-weight="600" fill="#7e22ce" text-anchor="middle">LD<tspan font-size="9" baseline-shift="sub">1</tspan></text>

  <!-- LD₁ timeline -->
  <line x1="70" y1="345" x2="920" y2="345" stroke="#d1d5db" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- === Revision 1 === -->

  <!-- Header (H) -->
  <rect x="80" y="302" width="40" height="36" rx="3" fill="url(#hatch)" stroke="#f59e0b" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="100" y="324" font-size="11" font-weight="700" fill="#92400e" text-anchor="middle">H</text>

  <!-- PF₁,₁ -->
  <rect x="130" y="302" width="70" height="36" rx="3" fill="#dbeafe" stroke="#3b82f6" stroke-width="1" filter="url(#shadow)"/>
  <text x="165" y="318" font-size="9" font-weight="600" fill="#1e40af" text-anchor="middle">PF<tspan font-size="7" baseline-shift="sub">1,1</tspan></text>
  <text x="165" y="330" font-size="8" fill="#3b82f6" text-anchor="middle">IndirPage</text>

  <!-- PF₂,₁ -->
  <rect x="210" y="302" width="70" height="36" rx="3" fill="#dbeafe" stroke="#3b82f6" stroke-width="1" filter="url(#shadow)"/>
  <text x="245" y="318" font-size="9" font-weight="600" fill="#1e40af" text-anchor="middle">PF<tspan font-size="7" baseline-shift="sub">2,1</tspan></text>
  <text x="245" y="330" font-size="8" fill="#3b82f6" text-anchor="middle">RecordPage</text>

  <!-- More pages indicator -->
  <text x="295" y="324" font-size="14" fill="#93c5fd" text-anchor="middle">...</text>

  <!-- PF₃,₁ -->
  <rect x="310" y="302" width="70" height="36" rx="3" fill="#dbeafe" stroke="#3b82f6" stroke-width="1" filter="url(#shadow)"/>
  <text x="345" y="318" font-size="9" font-weight="600" fill="#1e40af" text-anchor="middle">PF<tspan font-size="7" baseline-shift="sub">n,1</tspan></text>
  <text x="345" y="330" font-size="8" fill="#3b82f6" text-anchor="middle">NamePage</text>

  <!-- RRP₁ -->
  <rect x="390" y="296" width="55" height="48" rx="4" fill="#fed7aa" stroke="#f97316" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="418" y="318" font-size="10" font-weight="700" fill="#c2410c" text-anchor="middle">RRP</text>
  <text x="418" y="332" font-size="8" fill="#ea580c" text-anchor="middle">rev 1</text>

  <!-- === Revision 2 === -->

  <!-- PF₁,₂ (modified page) -->
  <rect x="460" y="302" width="70" height="36" rx="3" fill="#dbeafe" stroke="#3b82f6" stroke-width="1" filter="url(#shadow)"/>
  <text x="495" y="318" font-size="9" font-weight="600" fill="#1e40af" text-anchor="middle">PF<tspan font-size="7" baseline-shift="sub">1,2</tspan></text>
  <text x="495" y="330" font-size="8" fill="#3b82f6" text-anchor="middle">RecordPage</text>

  <!-- More pages indicator -->
  <text x="545" y="324" font-size="14" fill="#93c5fd" text-anchor="middle">...</text>

  <!-- PF₂,₂ -->
  <rect x="560" y="302" width="70" height="36" rx="3" fill="#dbeafe" stroke="#3b82f6" stroke-width="1" filter="url(#shadow)"/>
  <text x="595" y="318" font-size="9" font-weight="600" fill="#1e40af" text-anchor="middle">PF<tspan font-size="7" baseline-shift="sub">2,2</tspan></text>
  <text x="595" y="330" font-size="8" fill="#3b82f6" text-anchor="middle">PathPage</text>

  <!-- RRP₂ -->
  <rect x="640" y="296" width="55" height="48" rx="4" fill="#fed7aa" stroke="#f97316" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="668" y="318" font-size="10" font-weight="700" fill="#c2410c" text-anchor="middle">RRP</text>
  <text x="668" y="332" font-size="8" fill="#ea580c" text-anchor="middle">rev 2</text>

  <!-- === Revision 3 === -->

  <!-- PF₁,₃ -->
  <rect x="710" y="302" width="70" height="36" rx="3" fill="#dbeafe" stroke="#3b82f6" stroke-width="1" filter="url(#shadow)"/>
  <text x="745" y="318" font-size="9" font-weight="600" fill="#1e40af" text-anchor="middle">PF<tspan font-size="7" baseline-shift="sub">1,3</tspan></text>
  <text x="745" y="330" font-size="8" fill="#3b82f6" text-anchor="middle">RecordPage</text>

  <!-- RRP₃ -->
  <rect x="790" y="296" width="55" height="48" rx="4" fill="#fed7aa" stroke="#f97316" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="818" y="318" font-size="10" font-weight="700" fill="#c2410c" text-anchor="middle">RRP</text>
  <text x="818" y="332" font-size="8" fill="#ea580c" text-anchor="middle">rev 3</text>

  <!-- Continuation -->
  <text x="870" y="324" font-size="18" fill="#9ca3af" text-anchor="middle">...</text>

  <!-- Block size brackets for LD₁ -->
  <line x1="80" y1="348" x2="80" y2="356" stroke="#9ca3af" stroke-width="0.8"/>
  <line x1="80" y1="356" x2="120" y2="356" stroke="#9ca3af" stroke-width="0.8"/>
  <line x1="120" y1="348" x2="120" y2="356" stroke="#9ca3af" stroke-width="0.8"/>
  <text x="100" y="367" font-size="9" fill="#9ca3af" text-anchor="middle">Blk</text>

  <line x1="130" y1="348" x2="130" y2="356" stroke="#9ca3af" stroke-width="0.8"/>
  <line x1="130" y1="356" x2="200" y2="356" stroke="#9ca3af" stroke-width="0.8"/>
  <line x1="200" y1="348" x2="200" y2="356" stroke="#9ca3af" stroke-width="0.8"/>
  <text x="165" y="367" font-size="9" fill="#9ca3af" text-anchor="middle">Blk</text>

  <!-- === Offset arrows from LD₂ to LD₁ === -->

  <!-- R₁ offset arrow -->
  <path d="M 135 220 L 135 250 Q 135 260 145 260 L 408 260 Q 418 260 418 270 L 418 296"
        fill="none" stroke="#f59e0b" stroke-width="1.2" stroke-dasharray="4,2" marker-end="url(#arrow)"/>

  <!-- R₂ offset arrow -->
  <path d="M 245 220 L 245 250 Q 245 265 255 265 L 658 265 Q 668 265 668 275 L 668 296"
        fill="none" stroke="#f59e0b" stroke-width="1.2" stroke-dasharray="4,2" marker-end="url(#arrow)"/>

  <!-- R₃ offset arrow -->
  <path d="M 355 220 L 355 255 Q 355 270 365 270 L 808 270 Q 818 270 818 280 L 818 296"
        fill="none" stroke="#f59e0b" stroke-width="1.2" stroke-dasharray="4,2" marker-end="url(#arrow)"/>

  <!-- === Revision labels === -->
  <line x1="80" y1="385" x2="445" y2="385" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="80" y1="380" x2="80" y2="390" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="445" y1="380" x2="445" y2="390" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="262" y="402" font-size="12" font-weight="600" fill="#1d4ed8" text-anchor="middle">R<tspan font-size="9" baseline-shift="sub">1</tspan></text>

  <line x1="460" y1="385" x2="695" y2="385" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="460" y1="380" x2="460" y2="390" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="695" y1="380" x2="695" y2="390" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="578" y="402" font-size="12" font-weight="600" fill="#1d4ed8" text-anchor="middle">R<tspan font-size="9" baseline-shift="sub">2</tspan></text>

  <line x1="710" y1="385" x2="845" y2="385" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="710" y1="380" x2="710" y2="390" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="845" y1="380" x2="845" y2="390" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="778" y="402" font-size="12" font-weight="600" fill="#1d4ed8" text-anchor="middle">R<tspan font-size="9" baseline-shift="sub">3</tspan></text>

  <!-- === Key insight annotation === -->
  <rect x="40" y="430" width="880" height="70" rx="6" fill="#eff6ff" stroke="#bfdbfe" stroke-width="1"/>
  <text x="60" y="452" font-size="11" font-weight="600" fill="#1e40af">Copy-on-Write Versioning</text>
  <text x="60" y="468" font-size="10" fill="#3b82f6">LD<tspan font-size="8" baseline-shift="sub">2</tspan> stores the UberPage with timestamp + offset pairs pointing to each revision's RRP in LD<tspan font-size="8" baseline-shift="sub">1</tspan>.</text>
  <text x="60" y="482" font-size="10" fill="#3b82f6">Each revision only writes modified page fragments (copy-on-write). Unchanged pages are shared across revisions via references.</text>
  <text x="60" y="496" font-size="10" fill="#3b82f6">The RRP (RevisionRootPage) anchors each revision's page tree, enabling O(1) access to any historical version.</text>
</svg>
